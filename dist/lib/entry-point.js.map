{"version":3,"sources":["../lib/entry-point.ts"],"names":[],"mappings":"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","file":"entry-point.js","sourcesContent":["import { WorkspaceExtensions } from 'last-hit-types';\nimport { AbstractWorkspaceExtensionEntryPoint } from 'last-hit-workspace-extension';\n\nconst matrixRegexp = /^matrix:(.+)\\?(.+)$/;\n\nexport abstract class AbstractMatrixWorkspaceExtensionEntryPoint extends AbstractWorkspaceExtensionEntryPoint {\n\tasync handleFlowShouldStart(\n\t\tevent: WorkspaceExtensions.FlowShouldStartEvent,\n\t\thelpers: WorkspaceExtensions.HandlerTestHelper\n\t): Promise<WorkspaceExtensions.PreparedFlow> {\n\t\treturn await this.findHandler(\n\t\t\t`flow-should-start@${this.transformToRealFlowName(event.flow.name)}@${\n\t\t\t\tevent.story.name\n\t\t\t}`,\n\t\t\t'flow-should-start',\n\t\t\t`${event.story.name}/${this.transformToRealFlowName(event.flow.name)}/flow-should-start`\n\t\t).handle!(event, helpers);\n\t}\n\tasync handleFlowAccomplished(\n\t\tevent: WorkspaceExtensions.FlowAccomplishedEvent,\n\t\thelpers: WorkspaceExtensions.HandlerHelpers\n\t): Promise<WorkspaceExtensions.AccomplishedFlow> {\n\t\treturn await this.findHandler(\n\t\t\t`flow-accomplished@${this.transformToRealFlowName(event.flow.name)}@${\n\t\t\t\tevent.story.name\n\t\t\t}`,\n\t\t\t'flow-accomplished',\n\t\t\t`${event.story.name}/${this.transformToRealFlowName(event.flow.name)}/flow-accomplished`\n\t\t).handle!(event, helpers);\n\t}\n\n\tasync handleStepShouldStart(\n\t\tevent: WorkspaceExtensions.StepShouldStartEvent,\n\t\thelpers: WorkspaceExtensions.HandlerHelpers\n\t): Promise<WorkspaceExtensions.PreparedStep> {\n\t\treturn await this.findHandler(\n\t\t\t`step-should-start@${event.step.stepUuid}@${this.transformToRealFlowName(\n\t\t\t\tevent.flow.name\n\t\t\t)}@${event.story.name}`,\n\t\t\t'step-should-start',\n\t\t\t`${event.story.name}/${this.transformToRealFlowName(event.flow.name)}/${\n\t\t\t\tevent.step.stepUuid\n\t\t\t}/step-should-start`\n\t\t).handle!(event, helpers);\n\t}\n\tasync handleStepOnError(\n\t\tevent: WorkspaceExtensions.StepOnErrorEvent,\n\t\thelpers: WorkspaceExtensions.HandlerHelpers\n\t): Promise<WorkspaceExtensions.FixedStep> {\n\t\treturn await this.findHandler(\n\t\t\t`step-on-error@${event.step.stepUuid}@${this.transformToRealFlowName(\n\t\t\t\tevent.flow.name\n\t\t\t)}@${event.story.name}`,\n\t\t\t'step-on-error',\n\t\t\t`${event.story.name}/${this.transformToRealFlowName(event.flow.name)}/${\n\t\t\t\tevent.step.stepUuid\n\t\t\t}/step-on-error`\n\t\t).handle!(event, helpers);\n\t}\n\tasync handleStepAccomplished(\n\t\tevent: WorkspaceExtensions.StepAccomplishedEvent,\n\t\thelpers: WorkspaceExtensions.HandlerHelpers\n\t): Promise<WorkspaceExtensions.AccomplishedStep> {\n\t\treturn await this.findHandler(\n\t\t\t`step-accomplished@${event.step.stepUuid}@${this.transformToRealFlowName(\n\t\t\t\tevent.flow.name\n\t\t\t)}@${event.story.name}`,\n\t\t\t'step-accomplished',\n\t\t\t`${event.story.name}/${this.transformToRealFlowName(event.flow.name)}/${\n\t\t\t\tevent.step.stepUuid\n\t\t\t}/step-accomplished`\n\t\t).handle!(event, helpers);\n\t}\n\thandleReloadFlowHandler(event: WorkspaceExtensions.ReloadFlowHandlerEvent): Promise<void> {\n\t\tObject.values(this.getHandlers())\n\t\t\t.filter(handler => {\n\t\t\t\treturn (\n\t\t\t\t\thandler.story === event.story.name &&\n\t\t\t\t\thandler.flow === this.transformToRealFlowName(event.flow.name)\n\t\t\t\t);\n\t\t\t})\n\t\t\t.forEach(handler => {\n\t\t\t\tthis.doReloadHandler(handler);\n\t\t\t});\n\t\treturn Promise.resolve();\n\t}\n\thandleReloadStepHandler(event: WorkspaceExtensions.ReloadStepHandlerEvent): Promise<void> {\n\t\tObject.values(this.getHandlers())\n\t\t\t.filter(handler => {\n\t\t\t\treturn (\n\t\t\t\t\thandler.story === event.story.name &&\n\t\t\t\t\thandler.flow === this.transformToRealFlowName(event.flow.name) &&\n\t\t\t\t\thandler.stepUuid === event.step.stepUuid\n\t\t\t\t);\n\t\t\t})\n\t\t\t.forEach(handler => {\n\t\t\t\tthis.doReloadHandler(handler);\n\t\t\t});\n\t\treturn Promise.resolve();\n\t}\n\tprotected transformToRealFlowName(flowName: string): string {\n\t\tif (flowName.startsWith('matrix:')) {\n\t\t\tconst matches = flowName.match(matrixRegexp);\n\t\t\tif (matches == null) {\n\t\t\t\treturn flowName;\n\t\t\t} else {\n\t\t\t\treturn matches[1];\n\t\t\t}\n\t\t} else {\n\t\t\treturn flowName;\n\t\t}\n\t}\n}\n"]}